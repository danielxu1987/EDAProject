---
title: "EDA Project"
output:
  html_document:
    df_print: paged
runtime: shiny
---

This is the R Notebook for the project from Sifeng Xu, 24525844 for unit *CITS4009 Computation Data Analysis*. It demonstrates the process and findings of EDA based on the **Countries and Death Causes** dataset. 

```{r setup, echo=FALSE}
# Load  libraries
library(shiny)
library(shinyWidgets)
library(ggplot2)
library(gridExtra)
library(knitr)

# load dataset
df <- read.csv("./Countries and death causes.csv",header = T, sep=",")

```

## Basic information of the data


```{r glance, echo=TRUE}

data.frame(
  columeID = col(df)[1,],
  variables = names(df),
  class = sapply(df, typeof),
  first_values = sapply(df, function(x) paste0(head(x), collapse = ', ')),
  row.names = NULL) |>
kable()

summary(df) |> kable()

head(df) |> kable()

```


A first glance of data shows 31 columns which consists of 3 non-numerical data:

* countries' full name
* short country code
* year of measurements (1990-2019) 

the rest is numerical data showing how many deaths from each cause, each year and each country/region. Some countries are counted together such as *G20, OECD Countries, South-East Asia Region* and *Western Passific Region*. Also, some measured variables look similar such as *Outdoor.air.pollution, Household.air.pollution.from.solid.fuels* and *Air.pollution*.  

Most variables have zero values. This indicates that either no one died of that specific cause in a country in a specific year, or they were just missing values. Furthermore, there is no NA's in the dataset. 

```{r nas, echo=TRUE} 
print(sum(is.na(df)))

```

To give an impression what the dataset looks like, a snippet shows 6 countries and their deaths count from several causes in 2010.

```{r snippet, echo=TRUE}
df_2010 <- df[df['Year']==2010, 
  c('Entity', 'Code', 'Outdoor.air.pollution','Child.wasting', 'Smoking', 'Drug.use')]
countries <- c('Afghanistan', 'Morocco', 'Nigeria', 'Australia', 'Belgium', 'Congo')
snippet <- subset(df_2010, Entity %in% countries)
names(snippet)[1] <- 'Country'
snippet
```


## Plotting single variables

### Histogram


```{r histsingle, echo=FALSE}
# Define UI for application that draws a histogram
ui <- fluidPage(

    # Application title
    titlePanel("Histgram for single death cause"),

    # Sidebar with a slider input for number of bins 
    sidebarLayout(
        sidebarPanel(
          selectInput(inputId = "x", label = "Choose death cause", choices = names(df[, -c(1:3)]))
        ),
        # Show a plot of the generated distribution
        mainPanel(
           plotOutput("histogram")
        )
    )
)

# Define server logic required to draw a histogram
server <- function(input, output) {
    generate_histogram <- function(data, var, title) {
      ggplot(data) +
        geom_histogram(aes_string(x = var), bins = 40, fill = "gray") +
        labs(title = title, x = var, y = "Frequency", subtitle = 'Frequency per cause for all countries')
    }
    # Render the side-by-side histograms
    output$histogram <- renderPlot({
      generate_histogram(df, input$x, colnames(input$var))
    })
}

# Run the application 
shinyApp(ui = ui, server = server)
```


First check the data range by histogram. Variables that are linked to environment such as air and water quality tend to cause higher count of death (not unusual to have more than 10,000 deaths). This may prove that the long-term influence of a bad environment, which often sustains through a longer period, can kill many people living in that area/region. 

In contrast, causes such as *unsafe sex, durg use* and *alcohol use* generally lead to less mortality. These can be seen as individual's habit which do not have the massive impact in the whole community. 

Across all variables, high value of mortality does not appear often as most values seem to stay close to the lower boundary (a spike near zero).

## Boxplot single
```{r boxsingle, echo=FALSE}
# Define UI for application that draws a histogram
ui <- fluidPage(

    # Application title
    # titlePanel("Boxplot for single death cause per country"),

    # Sidebar with a slider input for number of bins 
    sidebarLayout(
        sidebarPanel(
          selectInput(inputId = "con", label = "Choose country", choices = unique(df$Entity)),
          selectInput(inputId = "var", label = "Choose death cause", choices = names(df[, -c(1:3)])),
        ),
        # Show a plot of the generated distribution
        mainPanel(
           plotOutput("boxplot")
        )
    )
)

# Define server logic required to draw a histogram
server <- function(input, output) {
  # Render the side-by-side histograms
  output$boxplot <- renderPlot({
    data <- df[df['Entity']==input$con,] #df[df['Entity']=='China',]
    boxplot(data[input$var], xlab=input$var, ylab = 'Count')
  })
}

# Run the application 
shinyApp(ui = ui, server = server)
```

### TODO

```{r histdouble, echo=FALSE}
ui <- fluidPage(

    # Application title
    titlePanel("Histogram within a country"),

    # Sidebar with a slider input for number of bins 
    sidebarLayout(
        sidebarPanel(
          selectInput(inputId = "con", label = "Choose country", choices = unique(df$Entity)),
          selectInput(inputId = "var1", label = "Choose death cause1", choices = names(df[, -c(1:3)])),
          selectInput(inputId = "var2", label = "Choose death cause2", choices = names(df[, -c(1:3)]))
        ),
        # Show a plot of the generated distribution
        mainPanel(
           plotOutput("histogram")
        )
    )
)

# Define server logic required to draw a histogram
server <- function(input, output) {
    generate_histogram <- function(data, con, x_var1, x_var2, title) {
      data <- data[data$Entity == con,]
      
      p1 <- ggplot(data, aes_string(x = x_var1)) +
        geom_histogram(bins = 20, fill = "gray") +
        labs(title = title, x = x_var1, y = "Frequency", subtitle = 'Frequency per cause per country')
      
      p2 <- ggplot(data, aes_string(x = x_var2)) +
        geom_histogram(bins = 20, fill = "gray") +
        labs(title = title, x = x_var2, y = "Frequency", subtitle = 'Frequency per cause per country')
      
      grid.arrange(p1, p2, nrow = 1)
    }
    # Render the side-by-side histograms
    output$histogram <- renderPlot({
      generate_histogram(df, input$con, input$var1, input$var2, colnames(input$var))
    })
}

# Run the application 
shinyApp(ui = ui, server = server)
```


